# Airflow Helm Values for Docker Desktop Kubernetes
# Adapted from INSTALL_DATASURFACE.md for local development

executor: CeleryExecutor

# Airflow version
images:
  airflow:
    repository: apache/airflow
    tag: "3.1.7"

# External PostgreSQL (running in Docker, accessible via host.docker.internal)
postgresql:
  enabled: false

data:
  metadataConnection:
    user: postgres
    pass: password
    protocol: postgresql
    host: host.docker.internal
    port: 5432
    db: airflow_db

# Redis for Celery broker
redis:
  enabled: true
  persistence:
    enabled: true
    storageClassName: standard

# Single scheduler for local dev
scheduler:
  replicas: 1

# Single worker for local dev
workers:
  replicas: 1
  persistence:
    enabled: true
    storageClassName: standard

# API server with NodePort for local access
apiServer:
  service:
    type: NodePort

# DAG processor
dagProcessor:
  enabled: true

# Triggerer for async sensors
triggerer:
  enabled: true

# GitSync for DAGs - pulls from GitHub repository
dags:
  persistence:
    enabled: false
  gitSync:
    enabled: true
    repo: https://github.com/datasurface/demo1_airflow.git  # Change to your DAG repo
    branch: main
    subPath: dags
    wait: 60
    credentialsSecret: git-dags  # Secret must have GITSYNC_USERNAME and GITSYNC_PASSWORD keys

# Logs - enable persistence for Docker Desktop (hostpath works for single-node clusters with RWX)
logs:
  persistence:
    enabled: true
    storageClassName: hostpath
    size: 5Gi

config:
  logging:
    delete_local_logs: "False"
  scheduler:
    dag_dir_list_interval: "60"

# Web UI credentials
webserver:
  defaultUser:
    enabled: true
    username: admin
    password: admin
